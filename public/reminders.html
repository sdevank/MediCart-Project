<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediCart - Reminders</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Unlock scrolling for the background */
        body.auth-page-bg {
            height: auto !important;
            min-height: 100vh;
            overflow-y: auto !important;
            padding-bottom: 50px;
        }
        
        /* Premium Dashboard Panels */
        .admin-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            padding: 30px;
            border-radius: 15px;
        }
        .admin-grid { 
            display: grid; 
            grid-template-columns: 1fr 2fr; 
            gap: 30px; 
            max-width: 1100px; 
            margin: 40px auto; 
            padding: 0 20px;
        }
        
        /* Stylish Reminder Cards */
        .reminder-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border: 1px solid #ecf0f1;
            border-left: 5px solid #f39c12; /* Orange accent line */
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .reminder-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.08);
            border-left-color: #e67e22;
        }
        
        .time-badge {
            background: #fff8e1;
            color: #f39c12;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid #ffeeba;
        }

        .remove-btn {
            background: #fff0f0;
            color: #e74c3c;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .remove-btn:hover { background: #e74c3c; color: white; transform: rotate(90deg); }

        @media (max-width: 800px) {
            .admin-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="auth-page-bg"> <nav class="navbar">
        <div class="logo">MediCart <span>+</span></div>
        <ul class="nav-links">
            <li><a href="home.html">Home</a></li>
            <li><a href="reminders.html" class="active">Reminders</a></li>
            <li><a href="my-orders.html">My Orders</a></li> 
            <li><a href="chatbot.html">Chatbot</a></li>
        </ul>
        <div class="nav-user">
            <span id="user-display">Hello, User</span>
            <a href="#" class="logout-btn" onclick="logout()">Logout</a>
        </div>
    </nav>
    
    <div id="toast-container"></div>

    <div class="admin-grid fade-in-up">
        
        <div class="admin-panel">
            <h3 style="color: #2c3e50; border-bottom: 2px dashed #bdc3c7; padding-bottom: 15px; margin-top: 0;">
                <i class="fas fa-bell" style="color: #f39c12; margin-right: 8px;"></i> Set Reminder
            </h3>
            
            <form id="reminder-form" style="margin-top: 25px;">
                <div class="form-group icon-input">
                    <i class="fas fa-pills"></i>
                    <input type="text" id="med-name" class="form-input" placeholder="Medicine Name" required>
                </div>
                <div class="form-group icon-input">
                    <i class="fas fa-prescription-bottle"></i>
                    <input type="text" id="med-dose" class="form-input" placeholder="Dosage (e.g. 1 Tablet)" required>
                </div>
                <div class="form-group icon-input">
                    <i class="fas fa-clock"></i>
                    <label for="med-time">Reminder Time:</label>
                    <input type="time" id="med-time" class="form-input" required title="Select a time for the reminder">
                </div>
                
                <button type="submit" class="auth-btn glow-btn" style="margin-top: 15px; background: linear-gradient(135deg, #f39c12, #e67e22); box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);">
                    Save Reminder
                </button>
            </form>
        </div>

        <div class="admin-panel">
            <h3 style="color: #2c3e50; border-bottom: 2px dashed #bdc3c7; padding-bottom: 15px; margin-top: 0;">
                <i class="fas fa-clipboard-check" style="color: #27ae60; margin-right: 8px;"></i> My Active Reminders
            </h3>
            
            <div id="reminder-list" style="margin-top: 25px; max-height: 500px; overflow-y: auto; padding-right: 10px;">
                <div style="text-align:center; padding: 40px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2.5rem; color: #3498db;"></i>
                    <p style="color: #7f8c8d; margin-top: 15px; font-weight: 600;">Loading reminders...</p>
                </div>
            </div>
        </div>
        
    </div>

    <script src="script.js"></script>
    <script>
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) window.location.href = 'login.html';
        document.getElementById('user-display').innerText = `Hello, ${user.firstName}`;

        // Convert 24hr time to 12hr format for beautiful display
        function formatAMPM(timeString) {
            const [hourString, minute] = timeString.split(":");
            let hour = parseInt(hourString);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            hour = hour % 12;
            hour = hour ? hour : 12; // the hour '0' should be '12'
            return `${hour}:${minute} ${ampm}`;
        }

        // 1. Fetch Reminders
        async function loadReminders() {
            const list = document.getElementById('reminder-list');
            try {
                if(!user.email) {
                    list.innerHTML = "<p style='color:#e74c3c; text-align:center;'>Please re-login to view reminders.</p>";
                    return;
                }

                const res = await fetch(`/api/reminders/${user.email}`);
                const reminders = await res.json();

                list.innerHTML = '';
                if(reminders.length === 0) {
                    list.innerHTML = `
                        <div style="text-align:center; padding: 40px 20px;">
                            <i class="far fa-bell-slash" style="font-size: 3rem; color: #bdc3c7; margin-bottom: 15px;"></i>
                            <h4 style="color: #2c3e50; margin:0 0 10px 0;">No Active Reminders</h4>
                            <p style="color: #7f8c8d; font-size: 0.95rem; margin:0;">Use the form on the left to set up a schedule for your medicines.</p>
                        </div>
                    `;
                    return;
                }

                // Sort reminders by time
                reminders.sort((a, b) => a.time.localeCompare(b.time));

                reminders.forEach(rem => {
                    const item = `
                        <div class="reminder-card">
                            <div>
                                <h4 style="margin: 0 0 5px 0; color: #2c3e50; font-size: 1.15rem;">${rem.medicineName}</h4>
                                <p style="margin: 0; color: #7f8c8d; font-weight: 600; font-size: 0.95rem;">
                                    <i class="fas fa-prescription-bottle-alt" style="margin-right: 5px;"></i> ${rem.dosage}
                                </p>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 20px;">
                                <div class="time-badge">
                                    <i class="far fa-clock"></i> ${formatAMPM(rem.time)}
                                </div>
                                <button class="remove-btn" onclick="deleteReminder('${rem._id}')" title="Delete Reminder">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    list.innerHTML += item;
                });
            } catch (err) {
                console.error(err);
                list.innerHTML = "<p style='text-align:center; color:#e74c3c;'>Error loading reminders.</p>";
            }
        }

        // 2. Add Reminder
        document.getElementById('reminder-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const btn = document.querySelector('.glow-btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
            btn.disabled = true;

            const newReminder = {
                userEmail: user.email,
                medicineName: document.getElementById('med-name').value,
                dosage: document.getElementById('med-dose').value,
                time: document.getElementById('med-time').value
            };

            try {
                const res = await fetch('/api/reminders', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newReminder)
                });
                
                if(res.ok) {
                    showToast("Reminder Set Successfully!", "success");
                    loadReminders(); 
                    e.target.reset(); 
                } else {
                    showToast("Failed to set reminder.", "error");
                }
            } catch (err) {
                showToast("Server Connection Error", "error");
            } finally {
                btn.innerHTML = 'Save Reminder';
                btn.disabled = false;
            }
        });

        // 3. Delete Reminder
        async function deleteReminder(id) {
            if(!confirm("Are you sure you want to delete this reminder?")) return;
            
            try {
                await fetch(`/api/reminders/${id}`, { method: 'DELETE' });
                showToast("Reminder removed", "info");
                loadReminders();
            } catch (err) {
                showToast("Error deleting reminder", "error");
            }
        }

        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('cart');
            window.location.href = 'login.html';
        }

        // Initialize
        loadReminders();
    </script>
</body>
</html>