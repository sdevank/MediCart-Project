<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediCart - Home</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="welcome-overlay">
    <div class="welcome-content">
        <div class="welcome-text">Welcome to MediCart</div>
        <div class="welcome-subtext">Your Health, Our Priority</div>
    </div>
</div>
    <nav class="navbar">
        <div class="logo">MediCart <span>+</span></div>
        <ul class="nav-links">
            <li><a href="home.html" class="active">Home</a></li>
            <li><a href="reminders.html">Reminders</a></li> <li><a href="#">Chatbot</a></li>
        </ul>

        <div class="nav-search">
            <input type="text" id="search-bar" placeholder="Search medicines..." aria-label="Search Medicines">
        </div>

        <div class="nav-user">
            <span id="user-display">Hello, User</span>
            <a href="#" class="logout-btn" onclick="logout()">Logout</a>
            
            <a href="cart.html">
                <div class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count">0</span>
                </div>
            </a>
        </div>
    </nav>

    <header class="hero reveal">
        <div class="hero-content">
            <div class="hero-text">
                <h1>Your Health,<br><span class="highlight">Our Priority</span></h1>
                <p>Order 100% genuine medicines online and get them securely delivered directly to your doorstep.</p>
                
                <div class="hero-features">
                    <span><i class="fas fa-truck"></i> Fast Delivery</span>
                    <span><i class="fas fa-shield-alt"></i> Genuine Meds</span>
                    <span><i class="fas fa-headset"></i> 24/7 Support</span>
                </div>
            </div>
            
            <div class="hero-image">
                <img src="https://images.unsplash.com/photo-1585435557343-3b092031a831?q=80&w=800&auto=format&fit=crop" alt="Pharmacy and Medicine">
            </div>
        </div>
    </header>

    <section class="popular-medicines-section">
        <div class="section-header">
            <h2 class="section-title reveal" style="text-align: center; margin-top: 40px;">Popular Medicines</h2>
    
    <div class="product-grid" id="product-list">
        </div> 
    </section> 

    <footer class="footer reveal">
        <div class="footer-container">
            <div class="footer-section">
                <h3>MediCart <span>+</span></h3>
                <p>Your trusted online pharmacy. Order medicines, upload prescriptions, set reminders, and consult our AI assistant anytime, anywhere.</p>
            </div>

            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="home.html">Home</a></li>
                    <li><a href="reminders.html">Medicine Reminders</a></li>
                    <li><a href="my-orders.html">My Orders</a></li>
                    <li><a href="chatbot.html">AI Health Assistant</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Contact Us</h3>
                <p><i class="fas fa-phone"></i> +91 9876543210</p>
                <p><i class="fas fa-envelope"></i> support@medicart.com</p>
                <p><i class="fas fa-map-marker-alt"></i> Kalyan, Maharashtra, India</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2026 MediCart. All rights reserved.</p>
        </div>
    </footer>
    <script src="script.js"></script>

<script>
    // 1. Check Auth
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user) {
        window.location.href = 'login.html';
    } else {
        document.getElementById('user-display').innerText = `Hello, ${user.firstName}`;
        updateCartCount(); 
    }

    let allMedicines = []; 
//render medicines on the page
// 2. Fetch & Render Medicines
    async function loadProducts() {
        const productList = document.getElementById('product-list');
        try {
            const response = await fetch('/api/products');
            allMedicines = await response.json();
            renderMedicines(allMedicines); 
        } catch (error) {
            console.error("Error loading products:", error);
            productList.innerHTML = "<p>Failed to load medicines.</p>";
        }
    }
    function renderMedicines(medicines) {
    const productList = document.getElementById('product-list');
    productList.innerHTML = ''; 

    if (medicines.length === 0) {
        productList.innerHTML = '<p>No medicines found.</p>';
        return;
    }

    medicines.forEach(med => {
        // 1. Add an Rx icon if prescription is required
        const rxBadge = med.requiresRx ? '<span style="color: #e74c3c; font-size: 0.8rem; font-weight: bold; margin-left: 5px;" title="Prescription Required">⚕️ Rx</span>' : '';
        
        // 2. Change the right button to "Upload Rx" if required
        const actionButton = med.requiresRx 
            ? `<button class="buy-btn" style="background-color: #c0392b;" onclick="window.location.href='upload.html'">Upload Rx</button>`
            : `<button class="buy-btn" onclick="buyNow('${med._id}', '${med.name}', ${med.price}, '${med.image}')">Buy Now</button>`;

        const card = `
            <div class="product-card">
                <span class="category-badge">${med.category}</span>
                
                <img src="${med.image}" alt="${med.name}">
                <h3>${med.name} ${rxBadge}</h3>
                <p class="price">₹${med.price}</p>
                
                <div style="display: flex; justify-content: space-between;">
                    <button class="add-btn" onclick="addToCart('${med._id}', '${med.name}', ${med.price}, '${med.image}')">
                        Add
                    </button>
                    ${actionButton}
                </div>
            </div>
        `;
        productList.innerHTML += card;
    });
}

    // 3. Search Functionality
    document.getElementById('search-bar').addEventListener('keyup', (e) => {
        const query = e.target.value.toLowerCase();
        const filtered = allMedicines.filter(med => 
            med.name.toLowerCase().includes(query) || 
            med.category.toLowerCase().includes(query)
        );
        renderMedicines(filtered);
    });

    // 4. Add to Cart Logic
    function addToCart(id, name, price, image) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        const existingItem = cart.find(item => item.id === id);
        
        if (existingItem) {
            existingItem.quantity += 1;
            showToast(`Increased quantity of ${name}`, "info");
        } else {
            cart.push({ id, name, price, image, quantity: 1 });
            showToast(`${name} added to cart!`, "success");
        }

        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
    }

    // 5. NEW: Buy Now Logic
    function buyNow(id, name, price, image) {
        // Add to cart first
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const existingItem = cart.find(item => item.id === id);
        
        if (existingItem) {
            existingItem.quantity += 1;
        } else {
            cart.push({ id, name, price, image, quantity: 1 });
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Redirect directly to checkout
        window.location.href = 'checkout.html';
    }

    function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const badge = document.querySelector('.cart-count');
        if(badge) badge.innerText = totalItems;
    }

    function logout() {
        localStorage.removeItem('user');
        localStorage.removeItem('cart'); 
        window.location.href = 'login.html';
    }

    // CHECK FOR WELCOME ANIMATION
function checkWelcomeAnimation() {
    const overlay = document.getElementById('welcome-overlay');
    
    // Check if the flag exists (Set during login)
    if (sessionStorage.getItem('showWelcome') === 'true') {
        
        //Show the animation
        overlay.style.display = 'flex'; 
        
        //Remove the flag IMMEDIATELY so it never plays again in this session
        sessionStorage.removeItem('showWelcome'); 

        //Play fade out logic
        setTimeout(() => {
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 1000); 
        }, 2500);
    } else {
        if(overlay) overlay.style.display = 'none';
    }
}

// Call this immediately
checkWelcomeAnimation();
    loadProducts();
</script>
<div class="floating-bot" onclick="window.location.href='chatbot.html'" title="Ask AI Assistant">
        <i class="fas fa-robot"></i>
    </div>

    <script>
        function revealOnScroll() {
            var reveals = document.querySelectorAll('.reveal');
            for (var i = 0; i < reveals.length; i++) {
                var windowHeight = window.innerHeight;
                var elementTop = reveals[i].getBoundingClientRect().top;
                var elementVisible = 100; // Triggers when element is 100px into view

                if (elementTop < windowHeight - elementVisible) {
                    reveals[i].classList.add('active');
                }
            }
        }
        window.addEventListener('scroll', revealOnScroll);
        // Trigger once on load so elements at the top appear immediately
        setTimeout(revealOnScroll, 100); 
    </script>
</body>
</html>